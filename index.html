<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>3D Model Viewer</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      background: #ececec;
    }
    a-scene {
      height: 100%;
      width: 100%;
    }
  </style>
</head>

<body>

<a-scene embedded vr-mode-ui="enabled:false">

  <!-- Fixed Camera -->
  <a-entity camera position="0 1.5 4"></a-entity>

  <!-- 3D MODEL (ROTATABLE + ZOOMABLE) -->
  <a-entity
    id="model"
    position="0 0 0"
    scale="1 1 1"
    rotation="0 0 0"
    model-controls>
  </a-entity>

  <!-- Lights -->
  <a-light type="ambient" intensity="1"></a-light>
  <a-light type="directional" intensity="1" position="2 4 5"></a-light>

  <a-sky color="#ECECEC"></a-sky>
</a-scene>

<script>
/* ðŸ”¥ CUSTOM COMPONENT: MODEL ROTATE + ZOOM */
AFRAME.registerComponent("model-controls", {
  init: function () {
    const el = this.el;
    let dragging = false;
    let lastX = 0;
    let lastY = 0;
    let scale = 1;

    // Mouse rotate
    window.addEventListener("mousedown", e => {
      dragging = true;
      lastX = e.clientX;
      lastY = e.clientY;
    });

    window.addEventListener("mouseup", () => dragging = false);

    window.addEventListener("mousemove", e => {
      if (!dragging) return;
      const dx = e.clientX - lastX;
      const dy = e.clientY - lastY;
      lastX = e.clientX;
      lastY = e.clientY;

      const rot = el.getAttribute("rotation");
      el.setAttribute("rotation", {
        x: rot.x + dy * 0.5,
        y: rot.y + dx * 0.5,
        z: 0
      });
    });

    // Zoom (mouse wheel)
    window.addEventListener("wheel", e => {
      scale += e.deltaY * -0.001;
      scale = Math.min(Math.max(0.3, scale), 3);
      el.setAttribute("scale", `${scale} ${scale} ${scale}`);
    });

    // Touch rotate + pinch zoom
    let lastDist = 0;
    window.addEventListener("touchmove", e => {
      if (e.touches.length === 1) {
        const t = e.touches[0];
        const dx = t.clientX - lastX;
        const dy = t.clientY - lastY;
        lastX = t.clientX;
        lastY = t.clientY;

        const rot = el.getAttribute("rotation");
        el.setAttribute("rotation", {
          x: rot.x + dy * 0.4,
          y: rot.y + dx * 0.4,
          z: 0
        });
      }

      if (e.touches.length === 2) {
        const dx = e.touches[0].clientX - e.touches[1].clientX;
        const dy = e.touches[0].clientY - e.touches[1].clientY;
        const dist = Math.sqrt(dx * dx + dy * dy);

        if (lastDist) {
          scale += (dist - lastDist) * 0.005;
          scale = Math.min(Math.max(0.3, scale), 3);
          el.setAttribute("scale", `${scale} ${scale} ${scale}`);
        }
        lastDist = dist;
      }
    });

    window.addEventListener("touchend", () => lastDist = 0);
  }
});

const glbUrl =
  "https://api.ipstudyhub.com/api/master/Download_interactive3dglbFile?fileName=71875cc3-44ff-4fa1-95cd-319bf07ce253_VR_Apple_Interactive.glb";

window.addEventListener("load", () => {
  document.getElementById("model")
    .setAttribute("gltf-model", glbUrl);
});
</script>

</body>
</html>
